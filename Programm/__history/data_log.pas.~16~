unit data_log;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls, Vcl.Grids,
  Vcl.ComCtrls;

type
  TForm8 = class(TForm)
    Panel1: TPanel;
    Panel2: TPanel;
    Panel3: TPanel;
    Button1: TButton;
    StringGrid1: TStringGrid;
    Timer_bd_data_log: TTimer;
    Button2: TButton;
    DateTimePicker1: TDateTimePicker;
    DateTimePicker2: TDateTimePicker;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    procedure Timer_bd_data_logTimer(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure Button2Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form8: TForm8;

implementation

{$R *.dfm}

uses System_, task;

procedure TForm8.Button2Click(Sender: TObject);
var
i, j: integer;
st:string;
begin
st:='SELECT `date_insert`,`sensor_id`,`rashod` FROM `records` where `date_insert` BETWEEN '+QuotedStr('2022-09-16 00:00:00')+' and '+QuotedStr('2022-09-17 00:00:00')+';';
//showmessage (st);
 for i := StringGrid1.FixedRows to StringGrid1.RowCount - 1 do StringGrid1.Rows[i].Clear;
    Form1.SQLQuery2.Active := False;
    Form1.SQLQuery2.SQL.Clear;
    Form1.SQLQuery2.SQL.Add  ('SELECT `date_insert`,`sensor_id`,`rashod` FROM `records` where `date_insert` BETWEEN '+QuotedStr('2022-09-16 00:00:00')+' and '+QuotedStr('2022-09-17 00:00:00')+';') ;
    Form1.SQLQuery2.Active := True;
    Form1.SQLQuery2.First;
    StringGrid1.RowCount:= form1.SQLQuery2.RecordCount+1;
    for j := 1 to form1.SQLQuery2.RecordCount do
       begin
       for i := 0 to 2 do
         begin
           StringGrid1.Cells[i,j]:=Form1.SQLQuery2.Fields[i].AsString;
        end;
      form1.SQLQuery2.Next;
      end;
end;

procedure TForm8.FormCreate(Sender: TObject);
begin
    StringGrid1.Cells[0,0]:='дата/время';
    StringGrid1.Cells[2,0]:='Расход';
    StringGrid1.Cells[1,0]:='# Затвора';

end;

procedure TForm8.Timer_bd_data_logTimer(Sender: TObject);
var
i, j: integer;
begin
 for i := StringGrid1.FixedRows to StringGrid1.RowCount - 1 do StringGrid1.Rows[i].Clear;
    Form1.SQLQuery2.Active := False;
    Form1.SQLQuery2.SQL.Clear;
    Form1.SQLQuery2.SQL.Add  ('SELECT `date_insert`,`sensor_id`,`rashod` FROM `records` ') ;
    Form1.SQLQuery2.Active := True;
    Form1.SQLQuery2.First;
    StringGrid1.RowCount:= form1.SQLQuery2.RecordCount+1;
    for j := 1 to form1.SQLQuery2.RecordCount do
       begin
       for i := 0 to 2 do
         begin
           StringGrid1.Cells[i,j]:=Form1.SQLQuery2.Fields[i].AsString;
        end;
      form1.SQLQuery2.Next;
      end;
end;

end.
